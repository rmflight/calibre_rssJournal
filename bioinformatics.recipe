from calibre.web.feeds.news import BasicNewsRecipe
from calibre.ebooks.BeautifulSoup import BeautifulSoup
import re

class BioinformaticsRecipe(BasicNewsRecipe):
  
    title = u'Bioinformatics Journal'
    language = 'en'
    oldest_article = 365
    feeds = [('Bioinformatics', 'https://dl.dropbox.com/s/m16gxh35ekf4qkk/bioinformatics_recent_test.rss')]
    
    def print_version(self, url):
        return url.replace('short', 'long')
        
#    def preprocess_raw_html(self, raw_html, url):
#        subbed_html = re.sub('.small.gif', '.large.jpg', raw_html)
#        return subbed_html
        
    # this switches to the large jpgs, and then sets a width limit on them
    def preprocess_html(self, soup):
        allImg = soup.findAll('img')
        #print allImg
        for imgTag in allImg:
            tmpSrc = imgTag['src']
            if re.search('.small.gif', tmpSrc):
                imgTag['src'] = re.sub('.small.gif', '.large.jpg', tmpSrc)
                imgTag['width'] = 600
            
            
        #print allImg # check that things got changed
        #print soup.prettify()
        return soup
        